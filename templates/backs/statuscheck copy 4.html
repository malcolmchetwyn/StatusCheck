<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Status Check</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</head>

<style>
    .navbar {
        padding-top: 10px;
        padding-bottom: 10px;
    }

    .container {
        max-width: 1200px; /* Restrict the maximum width */
        margin: 0 auto;    /* Center the navbar horizontally */
    }

    .navbar-brand img {
        margin-left: 10px; /* Optional: Adjust the margin for better spacing */
    }

    .navbar-text {
        margin-right: 10px; /* Optional: Adjust right margin for better spacing */
    }

            /* Footer styling */
            .footer {
       
            left: 0;
            bottom: 0;
            width: 100%;
            background-color: #f1f1f1;
            text-align: center;
            padding: 20px 10px 20px 10px;
            margin-top: 40px;
        }

   
   /* Input group styling */
   .input-group {
        position: relative;
    }

    /* Style for voice button inside input */
    .voice-btn {
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        cursor: pointer;
        color: #007bff;
    }

    .voice-btn:active {
        color: #0056b3;
    }
</style>


<body>

    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container" style="max-width: 1200px;">
            <a class="navbar-brand" href="#">
                <img src="/static/img/SpyTribe_logo.png" width="140" alt="Logo" class="d-inline-block align-top">
            </a>
            <!-- Navbar Toggler (Button to toggle on smaller screens) -->
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <!-- Navbar Links (Collapsible) -->
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item active">
                        <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
                    </li>
                    <!--
                    <li class="nav-item">
                        <a class="nav-link" href="#">Status Check</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Reports</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Settings</a>
                    </li>
                -->
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-5">
        <h2>Status Check for <span id="selected-date">Today</span></h2>

        <!-- Date Picker and Go Button -->
        <div class="form-inline mb-4">
            <input type="date" id="date-picker" class="form-control mr-2">
            <button class="btn btn-primary" onclick="loadDataForDate()">Go</button>
        </div>

        <!-- Progress Bar -->
        <div class="progress mb-4">
            <div class="progress-bar" id="progress-bar" role="progressbar" style="width: 0%"></div>
        </div>






  <!-- Accordion for sections -->
  <div id="accordion">
    <!-- Wake Up Section -->
    <div class="card">
        <div class="card-header" id="headingWakeUp">
            <h5 class="mb-0">
                <button class="btn btn-link" data-toggle="collapse" data-target="#wakeUp" aria-expanded="true" aria-controls="wakeUp">
                    Wake Up
                </button>
            </h5>
        </div>
        <div id="wakeUp" class="collapse show" aria-labelledby="headingWakeUp" data-parent="#accordion">
            <div class="card-body">

                <div class="form-group">
                    <label for="wake_up_mental">Mental Status:</label>
                    <div class="input-group">
                        <input type="text" id="wake_up_mental" class="form-control">
                        <span class="voice-btn" onclick="startDictation('wake_up_mental')">ðŸŽ¤</span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="wake_up_emotional">Emotional Status:</label>
                    <div class="input-group">
                        <input type="text" id="wake_up_emotional" class="form-control">
                        <span class="voice-btn" onclick="startDictation('wake_up_emotional')">ðŸŽ¤</span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="wake_up_physical">Physical Status:</label>
                    <div class="input-group">
                        <input type="text" id="wake_up_physical" class="form-control">
                        <span class="voice-btn" onclick="startDictation('wake_up_physical')">ðŸŽ¤</span>
                    </div>
                </div>

                <button class="btn btn-primary mt-3" onclick="submitSection('wakeUp')">Save</button>
            </div>
        </div>
    </div>

    <!-- Post Breakfast Section -->
    <div class="card">
        <div class="card-header" id="headingPostBreakfast">
            <h5 class="mb-0">
                <button class="btn btn-link collapsed" data-toggle="collapse" data-target="#postBreakfast" aria-expanded="false" aria-controls="postBreakfast">
                    Post Breakfast
                </button>
            </h5>
        </div>
        <div id="postBreakfast" class="collapse" aria-labelledby="headingPostBreakfast" data-parent="#accordion">
            <div class="card-body">
                <div class="form-group">
                    <label for="post_breakfast_mental">Mental Status:</label>
                    <div class="input-group">
                        <input type="text" id="post_breakfast_mental" class="form-control">
                        <span class="voice-btn" onclick="startDictation('post_breakfast_mental')">ðŸŽ¤</span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="post_breakfast_emotional">Emotional Status:</label>
                    <div class="input-group">
                        <input type="text" id="post_breakfast_emotional" class="form-control">
                        <span class="voice-btn" onclick="startDictation('post_breakfast_emotional')">ðŸŽ¤</span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="post_breakfast_physical">Physical Status:</label>
                    <div class="input-group">
                        <input type="text" id="post_breakfast_physical" class="form-control">
                        <span class="voice-btn" onclick="startDictation('post_breakfast_physical')">ðŸŽ¤</span>
                    </div>
                </div>

                <button class="btn btn-primary mt-3" onclick="submitSection('postBreakfast')">Save</button>
            </div>
        </div>
    </div>

    <!-- Post Lunch Section -->
    <div class="card">
        <div class="card-header" id="headingPostLunch">
            <h5 class="mb-0">
                <button class="btn btn-link collapsed" data-toggle="collapse" data-target="#postLunch" aria-expanded="false" aria-controls="postLunch">
                    Post Lunch
                </button>
            </h5>
        </div>
        <div id="postLunch" class="collapse" aria-labelledby="headingPostLunch" data-parent="#accordion">
            <div class="card-body">
                <div class="form-group">
                    <label for="post_lunch_mental">Mental Status:</label>
                    <div class="input-group">
                        <input type="text" id="post_lunch_mental" class="form-control">
                        <span class="voice-btn" onclick="startDictation('post_lunch_mental')">ðŸŽ¤</span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="post_lunch_emotional">Emotional Status:</label>
                    <div class="input-group">
                        <input type="text" id="post_lunch_emotional" class="form-control">
                        <span class="voice-btn" onclick="startDictation('post_lunch_emotional')">ðŸŽ¤</span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="post_lunch_physical">Physical Status:</label>
                    <div class="input-group">
                        <input type="text" id="post_lunch_physical" class="form-control">
                        <span class="voice-btn" onclick="startDictation('post_lunch_physical')">ðŸŽ¤</span>
                    </div>
                </div>

                <button class="btn btn-primary mt-3" onclick="submitSection('postLunch')">Save</button>
            </div>
        </div>
    </div>

    <!-- Post Dinner Section -->
    <div class="card">
        <div class="card-header" id="headingPostDinner">
            <h5 class="mb-0">
                <button class="btn btn-link collapsed" data-toggle="collapse" data-target="#postDinner" aria-expanded="false" aria-controls="postDinner">
                    Post Dinner
                </button>
            </h5>
        </div>
        <div id="postDinner" class="collapse" aria-labelledby="headingPostDinner" data-parent="#accordion">
            <div class="card-body">
                <div class="form-group">
                    <label for="post_dinner_mental">Mental Status:</label>
                    <div class="input-group">
                        <input type="text" id="post_dinner_mental" class="form-control">
                        <span class="voice-btn" onclick="startDictation('post_dinner_mental')">ðŸŽ¤</span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="post_dinner_emotional">Emotional Status:</label>
                    <div class="input-group">
                        <input type="text" id="post_dinner_emotional" class="form-control">
                        <span class="voice-btn" onclick="startDictation('post_dinner_emotional')">ðŸŽ¤</span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="post_dinner_physical">Physical Status:</label>
                    <div class="input-group">
                        <input type="text" id="post_dinner_physical" class="form-control">
                        <span class="voice-btn" onclick="startDictation('post_dinner_physical')">ðŸŽ¤</span>
                    </div>
                </div>

                <button class="btn btn-primary mt-3" onclick="submitSection('postDinner')">Save</button>
            </div>
        </div>
    </div>

    <!-- Bedtime Section -->
    <div class="card">
        <div class="card-header" id="headingBedtime">
            <h5 class="mb-0">
                <button class="btn btn-link collapsed" data-toggle="collapse" data-target="#bedtime" aria-expanded="false" aria-controls="bedtime">
                    Bedtime
                </button>
            </h5>
        </div>
        <div id="bedtime" class="collapse" aria-labelledby="headingBedtime" data-parent="#accordion">
            <div class="card-body">
                <div class="form-group">
                    <label for="bedtime_mental">Mental Status:</label>
                    <div class="input-group">
                        <input type="text" id="bedtime_mental" class="form-control">
                        <span class="voice-btn" onclick="startDictation('bedtime_mental')">ðŸŽ¤</span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="bedtime_emotional">Emotional Status:</label>
                    <div class="input-group">
                        <input type="text" id="bedtime_emotional" class="form-control">
                        <span class="voice-btn" onclick="startDictation('bedtime_emotional')">ðŸŽ¤</span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="bedtime_physical">Physical Status:</label>
                    <div class="input-group">
                        <input type="text" id="bedtime_physical" class="form-control">
                        <span class="voice-btn" onclick="startDictation('bedtime_physical')">ðŸŽ¤</span>
                    </div>
                </div>

                <button class="btn btn-primary mt-3" onclick="submitSection('bedtime')">Save</button>
            </div>
        </div>
    </div>

    <!-- Notes & Observations Section -->
    <div class="card">
        <div class="card-header" id="headingNotes">
            <h5 class="mb-0">
                <button class="btn btn-link collapsed" data-toggle="collapse" data-target="#notes" aria-expanded="false" aria-controls="notes">
                    Notes & Observations
                </button>
            </h5>
        </div>
        <div id="notes" class="collapse" aria-labelledby="headingNotes" data-parent="#accordion">
            <div class="card-body">
                <div class="form-group">
                    <label for="notes_observations">Notes & Observations:</label>
                    <div class="input-group">
                        <textarea id="notes_observations" class="form-control"></textarea>
                        <span class="voice-btn" onclick="startDictation('notes_observations')">ðŸŽ¤</span>
                    </div>
                </div>
                <button class="btn btn-primary mt-3" onclick="submitSection('notes')">Save</button>
            </div>
        </div>
    </div>

    <!-- Exercise Section -->
    <div class="card">
        <div class="card-header" id="headingExercise">
            <h5 class="mb-0">
                <button class="btn btn-link collapsed" data-toggle="collapse" data-target="#exercise" aria-expanded="false" aria-controls="exercise">
                    Exercise
                </button>
            </h5>
        </div>
        <div id="exercise" class="collapse" aria-labelledby="headingExercise" data-parent="#accordion">
            <div class="card-body">
                <div class="form-group">
                    <label for="exercise_details">Exercise Details:</label>
                    <div class="input-group">
                        <textarea id="exercise_details" class="form-control"></textarea>
                        <span class="voice-btn" onclick="startDictation('exercise_details')">ðŸŽ¤</span>
                    </div>
                </div>
                <button class="btn btn-primary mt-3" onclick="submitSection('exercise')">Save</button>
            </div>
        </div>
    </div>














    </div>

        <!-- Footer -->
        <footer class="footer">
            <span>Vitae Cognoscere</span>
        </footer>

    <script>



function startDictation(inputId) {
            if (window.hasOwnProperty('webkitSpeechRecognition')) {
                const recognition = new webkitSpeechRecognition();

                recognition.continuous = false;
                recognition.interimResults = false;

                recognition.lang = 'en-US';
                recognition.start();

                recognition.onresult = function(event) {
                    document.getElementById(inputId).value = event.results[0][0].transcript;
                    recognition.stop();
                };

                recognition.onerror = function() {
                    recognition.stop();
                };
            } else {
                alert("Speech recognition is not supported in this browser. Please try using Chrome or another supported browser.");
            }
        }

        document.addEventListener('DOMContentLoaded', function () {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('selected-date').innerText = "Today";
            loadData(today);  // Load data for today initially
        });

        function loadDataForDate() {
            const selectedDate = document.getElementById('date-picker').value;
            if (!selectedDate) {
                alert("Please select a date.");
                return;
            }
            document.getElementById('selected-date').innerText = selectedDate;
            loadData(selectedDate);
        }



        document.addEventListener('DOMContentLoaded', function () {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('selected-date').innerText = "Today";
            loadData(today);  // Load data for today initially
        });

        function loadDataForDate() {
            const selectedDate = document.getElementById('date-picker').value;
            if (!selectedDate) {
                alert("Please select a date.");
                return;
            }
            document.getElementById('selected-date').innerText = selectedDate;
            loadData(selectedDate);
        }

        function loadData(date) {
            fetch(`/status/${date}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error("Failed to fetch data for selected date.");
                    }
                    return response.json();
                })
                .then(data => {
                    console.log("Fetched data for date:", data); // Debugging line
                    if (Object.keys(data).length > 0) {
                        // Populate fields with the retrieved data
                        document.getElementById('wake_up_mental').value = data.wake_up_mental || '';
                        document.getElementById('wake_up_emotional').value = data.wake_up_emotional || '';
                        document.getElementById('wake_up_physical').value = data.wake_up_physical || '';
                        document.getElementById('post_breakfast_mental').value = data.post_breakfast_mental || '';
                        document.getElementById('post_breakfast_emotional').value = data.post_breakfast_emotional || '';
                        document.getElementById('post_breakfast_physical').value = data.post_breakfast_physical || '';
                        document.getElementById('post_lunch_mental').value = data.post_lunch_mental || '';
                        document.getElementById('post_lunch_emotional').value = data.post_lunch_emotional || '';
                        document.getElementById('post_lunch_physical').value = data.post_lunch_physical || '';
                        document.getElementById('post_dinner_mental').value = data.post_dinner_mental || '';
                        document.getElementById('post_dinner_emotional').value = data.post_dinner_emotional || '';
                        document.getElementById('post_dinner_physical').value = data.post_dinner_physical || '';
                        document.getElementById('bedtime_mental').value = data.bedtime_mental || '';
                        document.getElementById('bedtime_emotional').value = data.bedtime_emotional || '';
                        document.getElementById('bedtime_physical').value = data.bedtime_physical || '';
                        document.getElementById('notes_observations').value = data.notes_observations || '';
                        document.getElementById('exercise_details').value = data.exercise_details || '';

                        updateProgressBarFromData(data); // Update progress bar
                    } else {
                        alert("No data found for the selected date.");
                        clearFields();
                        resetProgressBar();
                    }
                })
                .catch(error => {
                    console.error('Error fetching data for selected date:', error);
                    alert('Error fetching data for selected date.');
                });
        }

        function clearFields() {
            document.getElementById('wake_up_mental').value = '';
            document.getElementById('wake_up_emotional').value = '';
            document.getElementById('wake_up_physical').value = '';
            document.getElementById('post_breakfast_mental').value = '';
            document.getElementById('post_breakfast_emotional').value = '';
            document.getElementById('post_breakfast_physical').value = '';
            document.getElementById('post_lunch_mental').value = '';
            document.getElementById('post_lunch_emotional').value = '';
            document.getElementById('post_lunch_physical').value = '';
            document.getElementById('post_dinner_mental').value = '';
            document.getElementById('post_dinner_emotional').value = '';
            document.getElementById('post_dinner_physical').value = '';
            document.getElementById('bedtime_mental').value = '';
            document.getElementById('bedtime_emotional').value = '';
            document.getElementById('bedtime_physical').value = '';
            document.getElementById('notes_observations').value = '';
            document.getElementById('exercise_details').value = '';
        }

function updateProgressBarFromData(data) {
    let filledFields = 0;
    const fields = [
        'wake_up_mental', 'wake_up_emotional', 'wake_up_physical',
        'post_breakfast_mental', 'post_breakfast_emotional', 'post_breakfast_physical',
        'post_lunch_mental', 'post_lunch_emotional', 'post_lunch_physical',
        'post_dinner_mental', 'post_dinner_emotional', 'post_dinner_physical',
        'bedtime_mental', 'bedtime_emotional', 'bedtime_physical',
        'notes_observations', 'exercise_details'
    ];

    // Check each field and count non-empty values
    fields.forEach(field => {
        if (data[field] && data[field].trim() !== '') {
            filledFields++;
        }
    });

    const progressBar = document.getElementById('progress-bar');
    const progressPercentage = (filledFields / fields.length) * 100;
    progressBar.style.width = `${progressPercentage}%`;
    // If 100% progress, change the color to green
    if (progressPercentage === 100) {
        progressBar.style.backgroundColor = 'green';
    } else {
        // Reset to the default color (bootstrap blue)
        progressBar.style.backgroundColor = '';
    }



}


// Function to reset the progress bar to 0% without animation
function resetProgressBar() {
    const progressBar = document.getElementById('progress-bar');
    
    // Temporarily disable transition to remove animation
    progressBar.style.transition = 'none';
    
    // Set progress bar width to 0%
    progressBar.style.width = '0%';
    
    // Allow the browser to render the change
    setTimeout(() => {
        // Re-enable transition for future progress bar updates
        progressBar.style.transition = '';
    }, 10); // Small delay to ensure rendering happens before transition is re-enabled
}

// Only return null if the whole section is empty, otherwise submit whatever is filled
function gatherSectionData(sectionId) {
    const data = { date: new Date().toISOString().split('T')[0] };
    
    switch (sectionId) {
        case 'wakeUp':
            data.wake_up_mental = document.getElementById('wake_up_mental').value || null;
            data.wake_up_emotional = document.getElementById('wake_up_emotional').value || null;
            data.wake_up_physical = document.getElementById('wake_up_physical').value || null;
            break;
        case 'postBreakfast':
            data.post_breakfast_mental = document.getElementById('post_breakfast_mental').value || null;
            data.post_breakfast_emotional = document.getElementById('post_breakfast_emotional').value || null;
            data.post_breakfast_physical = document.getElementById('post_breakfast_physical').value || null;
            break;
        case 'postLunch':
            data.post_lunch_mental = document.getElementById('post_lunch_mental').value || null;
            data.post_lunch_emotional = document.getElementById('post_lunch_emotional').value || null;
            data.post_lunch_physical = document.getElementById('post_lunch_physical').value || null;
            break;
        case 'postDinner':
            data.post_dinner_mental = document.getElementById('post_dinner_mental').value || null;
            data.post_dinner_emotional = document.getElementById('post_dinner_emotional').value || null;
            data.post_dinner_physical = document.getElementById('post_dinner_physical').value || null;
            break;
        case 'bedtime':
            data.bedtime_mental = document.getElementById('bedtime_mental').value || null;
            data.bedtime_emotional = document.getElementById('bedtime_emotional').value || null;
            data.bedtime_physical = document.getElementById('bedtime_physical').value || null;
            break;
        case 'notes':
            data.notes_observations = document.getElementById('notes_observations').value || null;
            break;
        case 'exercise':
            data.exercise_details = document.getElementById('exercise_details').value || null;
            break;
        default:
            return null;
    }
    
    return data; // Always return the data object, even if some fields are empty
}

        


        function submitSection(sectionId) {
    const sectionData = gatherSectionData(sectionId);
    console.log("Section Data being submitted:", sectionData);

    if (!sectionData) {
        alert("Please fill in all required fields.");
        return;
    }

    fetch('/status', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(sectionData),
    })
    .then(response => {
        if (!response.ok) {
            throw new Error("Network response was not ok");
        }
        return response.json();
    })
    .then(data => {
        console.log("Response from server:", data);
        if (data.message) {
            alert(`${sectionId} data saved successfully.`);
            // Re-fetch data to update the progress bar accurately
            const today = new Date().toISOString().split('T')[0];
            loadData(today); // Re-fetch data to ensure progress bar updates correctly
        } else {
            alert('Failed to save the data.');
        }
    })
    .catch((error) => {
        console.error('Error:', error);
        alert('An error occurred. Please try again.');
    });
}







    </script>

</body>
</html>
